<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="board">
  	<select id="selectCommentList" parameterType="map" resultType="bo">
		select * from 
		(SELECT ROWNUM AS RNUM,C.*FROM
          (SELECT 
			    COMMENT_NO as commentNo,
			    DIV_NO as divNo,
			    CASE
			        WHEN DIV_NO = 1
			        THEN (SELECT FUNDING_NAME FROM FUNDING WHERE FUNDING_NO = C.PROJECT_NO)
			        WHEN DIV_NO = 2
			        THEN (SELECT DONATION_TITLE FROM DONATION WHERE PROJECT_NO = C.PROJECT_NO)
			        WHEN DIV_NO = 4
			        THEN (SELECT PROJECT_NAME FROM AUCTION_TBL WHERE PROJECT_NO = C.PROJECT_NO)
			    END
			    as projectName,
			    comment_content as commentContent,
			    substr(comment_date,1,10) as commentDate
			FROM COMMENT_TBL C WHERE MEMBER_NO = #{memberNo} ORDER BY 1 DESC)C)
            where rnum between #{start} and #{end}
  	</select>
  	<select id="selectLikeList" parameterType="map" resultType="bo">
		select * from 
		(SELECT ROWNUM AS RNUM,C.*FROM
          (SELECT 
          		DIV_NO as divNo,
			    CASE
			        WHEN DIV_NO = 1
			        THEN (SELECT FUNDING_NAME FROM FUNDING WHERE FUNDING_NO = L.PROJECT_NO)
			        WHEN DIV_NO = 2
			        THEN (SELECT DONATION_TITLE FROM DONATION WHERE PROJECT_NO = L.PROJECT_NO)
			        WHEN DIV_NO = 4
			        THEN (SELECT PROJECT_NAME FROM AUCTION_TBL WHERE PROJECT_NO = L.PROJECT_NO)
			    END
			    as projectName,
			    project_no as projectNo
			FROM LIKE_TBL L WHERE MEMBER_NO = #{memberNo} ORDER BY 1 DESC)C)
            where rnum between #{start} and #{end}		
  	</select>
  	<select id="selectOrderList" parameterType="map" resultType="bo">
		select * from 
		(SELECT ROWNUM AS RNUM,C.*FROM
          (SELECT 
			    DIV_NO as divNo,
			    ORDER_NO as orderNo,
			    CASE
			        WHEN DIV_NO = 1
			        THEN (SELECT FUNDING_NAME FROM FUNDING WHERE FUNDING_NO = O.PROJECT_NO)
			        WHEN DIV_NO = 2
			        THEN (SELECT DONATION_TITLE FROM DONATION WHERE PROJECT_NO = O.PROJECT_NO)
			        WHEN DIV_NO = 4
			        THEN (SELECT PROJECT_NAME FROM AUCTION_TBL WHERE PROJECT_NO = O.PROJECT_NO)
			    END
			    as projectName,
			    order_price as orderPrice,
			    TO_CHAR(order_date, 'YYYY-MM-DD') as orderDate,
			    order_status as orderStatus
			FROM ORDER_TBL O WHERE MEMBER_NO = #{memberNo} ORDER BY 2 DESC)C)
            where rnum between #{start} and #{end}		
  	</select>
  	<select id="selectQnaList" parameterType="map" resultType="bo">
		select * from 
		(SELECT ROWNUM AS RNUM,C.*FROM
          (SELECT 
			    QNA_NO as qnaNo,
			    DIV_NO as divNo,
			    CASE
			        WHEN DIV_NO = 1
			        THEN (SELECT FUNDING_NAME FROM FUNDING WHERE FUNDING_NO = Q.PROJECT_NO)
			        WHEN DIV_NO = 2
			        THEN (SELECT DONATION_TITLE FROM DONATION WHERE PROJECT_NO = Q.PROJECT_NO)
			        WHEN DIV_NO = 4
			        THEN (SELECT PROJECT_NAME FROM AUCTION_TBL WHERE PROJECT_NO = Q.PROJECT_NO)
			    END
			    as projectName,
			    substr(qna_date,1,10) as qnaDate,
			    qna_complete as qnaComplete
			FROM QNA_TBL Q WHERE MEMBER_NO = #{memberNo} ORDER BY 1 DESC)C)
            where rnum between #{start} and #{end}
  	</select>
  	<select id="selectLikeCount" parameterType="map" resultType="int">
  		select count(*) from like_tbl where member_no=#{memberNo}
  	</select>
  	<select id="selectCommentCount" parameterType="map" resultType="int">
  		select count(*) from comment_tbl where member_no=#{memberNo}
  	</select>
  	<select id="selectOrderCount" parameterType="map" resultType="int">
  		select count(*) from order_tbl where member_no=#{memberNo}
  	</select>
  	<select id="selectQnaCount" parameterType="map" resultType="int">
  		select count(*) from 
  		<if test="boardName.equals('qna_tbl')"> 
  				qna_tbl
  		</if>
  		 where member_no=#{memberNo}
  	</select>
  	
  	<select id="selectOneOrder" parameterType="int" resultType="o">
  	SELECT ORDER_NO AS orderNo,
  		DIV_NO AS divNo,
  		PROJECT_NO AS projectNo,
  		MEMBER_NO AS memberNo,
  		SELLER_NO AS sellerNo,
  		TO_CHAR(ORDER_DATE, 'YYYY-MM-DD HH24:MI:SS') AS orderDate,
  		ORDER_PRICE AS orderPrice,
  		ORDER_POINT AS orderPoint,
  		ORDER_DEL_NAME AS orderDelName,
  		ORDER_DEL_POST AS orderDelPost,
  		ORDER_DEL_ADDR1 AS orderDelAddr1,
  		ORDER_DEL_ADDR2 AS orderDelAddr2,
  		ORDER_DEL_PHONE AS orderDelPhone,
  		ORDER_DEL_ASK AS orderDelAsk,
  		ORDER_STATUS AS orderStatus,
        PROJECT_NAME AS projectName
  		FROM ORDER_TBL WHERE ORDER_NO = #{orderNo}  	
  	</select>
  	
  	<select id="selectOrderProduct" parameterType="o" resultType="op">        
    SELECT PRODUCT_NO AS productNo,
        ORDER_NO AS orderNo,
        OPTION_NO AS optionNo,
        PRODUCT_PRICE AS productPrice,
        PRODUCT_AMOUNT AS productAmount,
        
        <choose>
        	<when test="divNo==1">
		        FUNDING_OPTION_LIST AS productName,        	
        	</when>
        	<when test="divNo==2">
		        DONATION_CATEGORY AS productName,        	
        	</when>
        	<when test="divNo==4">
		        AUCTION_ITEM AS productName,        	
        	</when>
        </choose>
        ORDER_STATUS AS OrderStatus FROM ORDER_PRODUCT JOIN ORDER_TBL USING(ORDER_NO) JOIN        
        <choose>
        	<when test="divNo==1">
        		FUNDING_OPTION_PRICE ON(PROJECT_NO=FUNDING_NO)
        	</when>
        	<when test="divNo==2">
        		DONATION USING(PROJECT_NO)
        	</when>
        	<when test="divNo==4">
        		AUCTION_TBL USING(PROJECT_NO)
        	</when>
        </choose>        
        WHERE ORDER_NO = #{orderNo}
  </select>
  <update id="updateOrder" parameterType="o">
  	UPDATE ORDER_TBL SET
  		ORDER_DEL_NAME = #{orderDelName},
  		ORDER_DEL_PHONE = #{orderDelPhone},
  		ORDER_DEL_ADDR1 = #{orderDelAddr1},
  		ORDER_DEL_ADDR2 = #{orderDelAddr2},
  		ORDER_DEL_POST = #{orderDelPost},
  		ORDER_DEL_ASK = #{orderDelAsk}
  	WHERE ORDER_NO = #{orderNo}
  </update>
</mapper>
