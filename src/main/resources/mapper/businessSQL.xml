<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="business">
	<select id="selectAucList" parameterType="int" resultType="a">
		select * from (select rownum as rnum,n.* from (
			select distinct
				a.project_no as projectNo,
				project_name as projectName,
				auction_item as auctionItem,
				auction_category as auctionCategory,
				auction_amount as auctionAmount,
				to_char(auction_start,'yyyy/mm/dd') as auctionStart,
				to_char(auction_end,'yyyy/mm/dd') as auctionEnd,
				a.member_no as memberNo,
				auction_price as auctionPrice
			from auction_tbl a
			left join bid_tbl b on (b.project_no=a.project_no)
			where a.member_no=100 and 
			to_number(to_char(auction_end,'yymmdd')) <![CDATA[ >= ]]> to_number(to_char(sysdate,'yymmdd')) 
			order by a.project_no desc
		)n) where rnum between 1 and 5
	</select>
	<select id="selectExpiredAucList" parameterType="int"
		resultType="a">
		select * from (select rownum as rnum,n.* from (
			select distinct
				a.project_no as projectNo,
				project_name as projectName,
				auction_item as auctionItem,
				auction_category as auctionCategory,
				auction_amount as auctionAmount,
				to_char(auction_start,'yyyy/mm/dd') as auctionStart,
				to_char(auction_end,'yyyy/mm/dd') as auctionEnd,
				a.member_no as memberNo,
				auction_price as auctionPrice
			from auction_tbl a
			left join bid_tbl b on (b.project_no=a.project_no)
			where a.member_no=100 and 
			to_number(to_char(auction_end,'yymmdd')) <![CDATA[ < ]]> to_number(to_char(sysdate,'yymmdd')) 
			order by a.project_no desc
		)n) where rnum between 1 and 5
	</select>
	<select id="selectBestPrice" parameterType="map" resultType="a">
		select
			max(bid_price) as bestPrice
		from bid_tbl b
		join auction_tbl a on(a.project_no=b.project_no)
		where a.member_no=#{memberNo} and a.project_no=#{projectNo}
	</select>

	<select id="selectDnList" parameterType="int" resultType="d">
		select * from (select rownum as rnum,n.* from (
			select 
				project_no as projectNo, 
				member_no as memberNo,
				donation_division as donationDivision,
				donation_title as donationTitle, 
				donation_category as donationCategory,
				donation_target as donationTarget, 
				donation_cash as donationCash,
				to_char(donation_startdate,'yyyy/mm/dd') as donationStartdate, 
				to_char(donation_enddate,'yyyy/mm/dd') as donationEnddate 
			from donation 
			where member_no=#{memberNo} and
			to_number(to_char(donation_enddate,'yymmdd')) <![CDATA[ >= ]]> to_number(to_char(sysdate,'yymmdd')) 
			order by project_no desc
		)n) where rnum between 1 and 5
	</select>
	<select id="selectExpiredDnList" parameterType="int" resultType="d">
		select * from (select rownum as rnum,n.* from (
			select 
				project_no as projectNo, 
				member_no as memberNo,
				donation_division as donationDivision,
				donation_title as donationTitle, 
				donation_category as donationCategory,
				donation_target as donationTarget, 
				donation_cash as donationCash,
				to_char(donation_startdate,'yyyy/mm/dd') as donationStartdate, 
				to_char(donation_enddate,'yyyy/mm/dd') as donationEnddate 
			from donation 
			where member_no=#{memberNo} and
			to_number(to_char(donation_enddate,'yymmdd')) <![CDATA[ < ]]> to_number(to_char(sysdate,'yymmdd')) 
			order by project_no desc
		)n) where rnum between 1 and 5
	</select>
	
	<delete id="deleteAuction" parameterType="int">
		delete from auction_tbl where project_no=#{projectNo}		
	</delete>
	
	<select id="checkDnOrder" parameterType="int" resultType="int">
		select count(project_no) from order_tbl where project_no=#{projectNo} and div_no=2
	</select>
	<delete id="deleteDonation" parameterType="int">
		delete from donation where project_no=#{projectNo}		
	</delete>
</mapper>
